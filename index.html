<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Curso Interactivo de IA</title>
<style>
:root{
  --azul-osc:#0d1b2a;
  --azul:#0074D9;
  --celeste:#00bfff;
  --azul-btn:#2563eb;
  --azul-btn-hover:#1e40af;
  --verde:#22c55e;
  --verde-hover:#16a34a;
  --naranja:#f97316;
  --naranja-hover:#fb923c;
}
*{box-sizing:border-box;}
body{
  margin:0;
  font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  background-size: 400% 400%;
  animation: gradient 12s ease infinite;
  color:#fff;
}
@keyframes gradient {
  0% {background-position:0% 50%;}
  50% {background-position:100% 50%;}
  100% {background-position:0% 50%;}
}
header{
  background-color: rgba(13,27,42,0.95);
  padding: 12px 16px;
  border-bottom:3px solid var(--celeste);
  box-shadow:0 4px 12px rgba(0,0,0,0.35);
  position:sticky; top:0; z-index:10;
  display:flex; align-items:center; justify-content:space-between;
  flex-wrap:wrap;
}
.brand{
  display:flex; align-items:center; gap:10px;
}
.brand img{
  width:42px; height:42px; border-radius:50%;
}
.brand h1{
  margin:0; font-size:22px;
}
nav{ display:flex; gap:8px; flex-wrap:wrap; }
nav button{
  padding: 10px 18px;
  border:none;
  background: linear-gradient(45deg,var(--azul-btn),#9333ea);
  color:#fff; cursor:pointer;
  border-radius:12px; font-weight:600;
  transition: .2s;
  box-shadow:0 3px 8px rgba(0,0,0,0.2);
}
nav button:hover{ background: linear-gradient(45deg,var(--azul-btn-hover),#7e22ce); transform: translateY(-2px); }
.vidas{
  background-color: rgba(0,0,0,0.5);
  padding: 6px 10px; border-radius: 14px;
  display:inline-flex; gap:6px; align-items:center;
}
.corazon{
  display:inline-block; width:20px; height:20px;
  background:red;
  clip-path: polygon(50% 0%,61% 14%,75% 14%,84% 25%,84% 38%,75% 50%,50% 75%,25% 50%,16% 38%,16% 25%,25% 14%,39% 14%);
}
.corazon.vacio{ background:#777; }
.racha{ font-weight:700; color:#ffd700; margin-left:10px; }
.section{ display:none; padding:20px; max-width:1000px; margin:0 auto; }
.active{ display:block; }
.modulos-list{
  display:grid; grid-template-columns: repeat(auto-fit,minmax(220px,1fr));
  gap:16px; margin-top:16px;
}
.modulo-card{
  padding:16px; border-radius:14px; text-align:center;
  border: 2px solid var(--celeste);
  transition:.25s; cursor:pointer;
  background: rgba(0,31,63,0.75);
}
.modulo-card.desbloqueado{
  background: linear-gradient(135deg,#0074D9,#00bfff);
  color:#fff;
}
.modulo-card.desbloqueado:hover{
  background: linear-gradient(135deg,#00bfff,#0074D9); transform: translateY(-3px);
}
.modulo-card.completado{
  background: linear-gradient(135deg,#22c55e,#16a34a);
  border: 2px solid #1e7e34;
  color:#fff;
  cursor: pointer;
}
.modulo-card.bloqueado{
  background: rgba(0,31,63,0.35); color:#cfcfcf; border:2px dashed #888;
  cursor:not-allowed; pointer-events:none;
}
.pregunta{
  margin: 14px 0; padding:16px;
  background-color: rgba(0,43,92,0.85);
  border-radius:14px; border:1px solid var(--celeste);
}
.preguntas-wrapper{
  max-height: calc(100vh - 200px);
  overflow-y: auto;
  padding-right:10px;
}
button.responder, button.siguiente, button.intentar, button.guardarSalir{
  margin-top:10px; padding:12px 16px; border-radius:10px; border:none;
  background: linear-gradient(45deg,var(--azul-btn),#00bfff);
  color:#fff; cursor:pointer; font-weight:700;
  width:100%; max-width:340px;
  transition:.25s;
}
button.responder:hover, button.siguiente:hover, button.intentar:hover, button.guardarSalir:hover{
  background: linear-gradient(45deg,var(--azul-btn-hover),#7dd3fc); transform: translateY(-2px);
}
button.volver{
  margin-top:14px; padding:12px 16px; border-radius:10px; border:none;
  background: linear-gradient(45deg,var(--azul-btn),#00bfff); color:#fff; font-weight:700; cursor:pointer;
}
button.volver:hover{ background: linear-gradient(45deg,var(--azul-btn-hover),#7dd3fc); transform: translateY(-2px); }
button.salir{
  margin-bottom:12px; padding:10px 14px; border-radius:10px; border:none;
  background: linear-gradient(45deg,var(--naranja),#fb923c); color:#fff; font-weight:800; cursor:pointer;
  width:auto;
}
button.salir:hover{ background: linear-gradient(45deg,var(--naranja-hover),#ffb366); transform: translateY(-2px); }
input, button.registro, button.login{
  width:100%; padding:12px 16px; border-radius:10px; border:none; font-size:16px; font-weight:700; cursor:pointer; margin-top:8px;
}
button.registro{ background: linear-gradient(45deg,#22c55e,#16a34a); color:#fff; transition:.2s;}
button.registro:hover{ background: linear-gradient(45deg,#16a34a,#22c55e); }
button.login{ background: linear-gradient(45deg,var(--azul-btn),#00bfff); color:#fff; transition:.2s;}
button.login:hover{ background: linear-gradient(45deg,var(--azul-btn-hover),#7dd3fc); }
#pantallaInicio{
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  height:100vh; text-align:center; gap:20px;
}
#mensajeRespuesta{
  text-align:center;
  font-size:20px;
  margin-top:10px;
  font-weight:bold;
}
#barraProgresoContainer{
  width:100%; background:#444; border-radius:12px; overflow:hidden; margin:10px 0;
}
#barraProgreso{
  width:0%; height:20px; background: #22c55e; transition:0.3s;
}
body::before {
  content: "";
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: url("poo.png") no-repeat center center;
  background-size: 500px; /* aumentado */
  opacity: 0.07;
  z-index: 0;
  pointer-events: none;
}
.racha::before {
  content: "🔥 ";
}
</style>
</head>
<body>
<header id="siteHeader" style="display:none;">
<div class="brand" style="display:flex; align-items:center; gap:10px;">
<img alt="Avatar" id="avatarHeader" src="" style="width:42px; height:42px; display:none;"/>
<h1 style="margin:0; font-size:28px;">Curso Interactivo de IA</h1>
</div>
<nav>
<button onclick="mostrarSeccion('inicio')">Inicio</button>
<button onclick="mostrarSeccion('lecciones')">Lecciones</button>
</nav>
<div style="display:flex; justify-content:center; align-items:center; gap:10px; margin-top:10px;">
<div class="vidas" id="barra-vidas"></div>
<div class="racha" id="barra-racha">Racha: 0</div>
</div>
</header>
<div id="pantallaInicio">
<div class="brand" style="margin-bottom:20px;">
<img alt="Logo IA" src="ia-logo.svg" style="width:120px; height:120px;"/>
<h1>Curso Interactivo de IA</h1>
</div>
<div id="registroLogin" style="display:flex; flex-direction:column; gap:12px; max-width:400px; width:100%; margin:0 auto;">
<input id="usuarioNombre" placeholder="Ingrese su nombre completo" type="text"/>
<button class="registro" onclick="registrarUsuario()">Registrarse</button>
<button class="login" onclick="iniciarSesion()">Iniciar sesión</button>
</div>
<p id="mensajeUsuario" style="color:#ffb3b3; text-align:center; margin-top:10px;"></p>
</div>
<!-- Selección de avatar -->
<div id="seleccionAvatar" style="display:none; text-align:center; margin-top:50px;">
<h2>Selecciona tu avatar</h2>
<div id="avatarOptions" style="display:flex; gap:20px; justify-content:center; margin-top:20px;">
<img alt="Avatar 1" onclick="elegirAvatar('qq3.png')" src="qq3.png" style="width:120px; height:120px; cursor:pointer; border-radius:50%;"/>
<img alt="Avatar 2" onclick="elegirAvatar('qq4.png')" src="qq4.png" style="width:120px; height:120px; cursor:pointer; border-radius:50%;"/>
<img alt="Avatar 3" onclick="elegirAvatar('qq2.png')" src="qq2.png" style="width:120px; height:120px; cursor:pointer; border-radius:50%;"/>
<img alt="Avatar 4" onclick="elegirAvatar('qq1.png')" src="qq1.png" style="width:120px; height:120px; cursor:pointer; border-radius:50%;"/>
</div>
</div>
<!-- Pantalla de inicio -->
<div class="section" id="inicio" style="position:relative; overflow:hidden;">
<!-- Canvas de partículas -->
<canvas id="particlesCanvas" style="position:absolute; top:0; left:0; width:100%; height:100%; z-index:0;"></canvas>
<!-- Contenido principal -->
<div style="position:relative; z-index:1; display:flex; flex-direction:column; align-items:center; text-align:center; padding:60px 20px;">
<img alt="Logo IA" src="ia-logo.svg" style="width:160px; height:160px; margin-bottom:20px;"/>
<h2 style="font-size:36px; margin:10px 0; color:#00bfff; text-shadow: 0 0 15px rgba(0,191,255,0.7);">
      🌌 Bienvenido al Curso Interactivo de Inteligencia Artificial 🌌
    </h2>
<p style="max-width:800px; font-size:18px; line-height:1.6; margin-top:10px; color:#e0e0e0;">
      Explora el fascinante mundo de la Inteligencia Artificial de manera práctica y divertida.  
      Desbloquea módulos, responde preguntas interactivas y gana logros mientras aprendes.
    </p>
<button class="siguiente" onclick="mostrarSeccion('lecciones')" style="margin-top:30px; font-size:18px; padding:14px 24px;">
      🚀 ¡Comenzar el aprendizaje!
    </button>
</div>
<!-- Beneficios -->
<div style="position:relative; z-index:1; display:grid; grid-template-columns: repeat(auto-fit, minmax(240px,1fr)); gap:24px; margin-top:50px; padding:0 20px;">
<div style="background:rgba(0,0,0,0.6); padding:20px; border-radius:14px; text-align:center;">
<h3>📖 Aprende paso a paso</h3>
<p>Lecciones claras y fáciles de seguir para todos los niveles.</p>
</div>
<div style="position:relative; z-index:1; display:grid; grid-template-columns: repeat(auto-fit, minmax(240px,1fr)); gap:24px; margin-top:50px; padding:0 20px;">
<div style="background:rgba(0,0,0,0.6); padding:20px; border-radius:14px; text-align:center;">
<h3>🧠 Practica con retos</h3>
<p>Preguntas y actividades interactivas para reforzar tu aprendizaje.</p>
</div>
<div style="background:rgba(0,0,0,0.6); padding:20px; border-radius:14px; text-align:center;">
<h3>🏆 Supera niveles</h3>
<p>Gana rachas, desbloquea módulos y alcanza nuevos logros.</p>
</div>
</div>
</div>
</div>
<div class="section" id="lecciones">
<h2>Lecciones y Módulos</h2>
<div class="modulos-list" id="modulos"></div>
<div id="leccionesMenu" style="display:none; text-align:center;"><div class="modulos-list" id="listaLecciones"></div><button class="volver" onclick="volverAModulos()" style="margin-top:20px;">Volver a módulos</button></div>
<div id="leccionInfo" style="display:none; max-width:800px; margin:0 auto; text-align:center;">
<h2 id="tituloLeccion"></h2>
<p id="contenidoLeccion"></p>
<button class="siguiente" onclick="empezarPreguntas()">Empezar preguntas</button>

</div>
<div id="barraProgresoContainer" style="display:none;"><div id="barraProgreso"></div></div>
<div class="preguntas-wrapper" id="pregunta-container" style="display:none;"></div>
<div id="mensajeRespuesta"></div>
</div>

<!-- ===== SECCIÓN EXAMEN FINAL (insertada automáticamente) ===== -->
<div class="section" id="examenFinal" style="display:none; padding:20px; max-width:1000px; margin:0 auto; text-align:center;">
  <h2>📝 Examen Final</h2>
  <p>Tienes <strong>10 minutos</strong> para responder todas las preguntas. Las preguntas son aleatorias de todo el curso.</p>
  <div id="timer" style="font-weight:bold; font-size:20px; color:#ffeb3b; margin:10px 0;"></div>
  <div class="preguntas-wrapper" id="pregunta-examen"></div>
  <div id="mensajeExamen" style="margin-top:12px; font-weight:700;"></div>
  <div style="margin-top:12px;">
    <button class="volver" onclick="finalizarExamen('cancel')">Salir del examen</button>
  </div>
</div>
<!-- ===== FIN SECCIÓN EXAMEN FINAL ===== -->
<!-- ===== DIPLOMA (OCULTO POR DEFECTO) ===== -->
<div id="diploma" style="
      display:none;
      width:100%;
      max-width:900px;
      margin:40px auto;
      background:#fff;
      color:#333;
      border:8px solid #0d1b2a;
      border-radius:12px;
      padding:50px;
      font-family:'Segoe UI',sans-serif;
      position:relative;
      box-shadow:0 8px 24px rgba(0,0,0,0.25);
      overflow:hidden;
    ">

      <!-- HEXÁGONOS DE FONDO -->
      <div style="position:absolute; top:-60px; left:-60px; width:200px; height:200px; background:linear-gradient(135deg,#0077b6,#0096c7); clip-path:polygon(25% 6.7%, 75% 6.7%, 100% 50%, 75% 93.3%, 25% 93.3%, 0% 50%); opacity:0.25;"></div>
      <div style="position:absolute; bottom:-70px; right:-70px; width:220px; height:220px; background:linear-gradient(135deg,#0077b6,#0096c7); clip-path:polygon(25% 6.7%, 75% 6.7%, 100% 50%, 75% 93.3%, 25% 93.3%, 0% 50%); opacity:0.25;"></div>
      <div style="position:absolute; top:30%; left:-80px; width:160px; height:160px; background:#eee; clip-path:polygon(25% 6.7%, 75% 6.7%, 100% 50%, 75% 93.3%, 25% 93.3%, 0% 50%); opacity:0.5;"></div>
      <div style="position:absolute; bottom:30%; right:-80px; width:160px; height:160px; background:#eee; clip-path:polygon(25% 6.7%, 75% 6.7%, 100% 50%, 75% 93.3%, 25% 93.3%, 0% 50%); opacity:0.5;"></div>
      
      <!-- LOGO ARRIBA IZQUIERDA -->
      <div style="position:absolute; top:20px; left:20px; text-align:left;">
        <img src="ia-logo.svg" alt="logo" style="width:100px; height:auto;">
        <p style="margin:0; font-weight:bold;">Curso Interactivo de IA</p>
      </div>
      
      <!-- INSIGNIA ARRIBA DERECHA -->
      <div style="position:absolute; top:20px; right:20px; text-align:right;">
        <img src="poo.png" alt="Insignia" style="width:100px; height:auto;">
      </div>

      <!-- TITULO PRINCIPAL -->
      <h1 style="text-align:center; font-size:42px; margin-top:40px; color:#0d1b2a; letter-spacing:2px;">
        CERTIFICADO
      </h1>
      <h2 style="text-align:center; font-size:22px; margin:0; color:#666;">
        De Logro Académico
      </h2>

      <p style="text-align:center; font-size:18px; margin-top:20px; color:#444;">
        Este certificado es otorgado a
      </p>

      <!-- NOMBRE DEL USUARIO -->
      <div style="text-align:center; margin:20px 0;">
      <h2 id="nombre-diploma" style="
      font-size:32px;
      font-family:'Georgia',serif;
      font-weight:bold;
      color:#0d1b2a;
      border-bottom:2px solid #ccc;
      display:inline;
      padding:0 10px;
      ">Estudiante</h2>
      </div>

      <p style="text-align:center; max-width:650px; margin:20px auto; font-size:15px; color:#555;">
        Por haber completado satisfactoriamente todas las lecciones del curso 
        <b>Inteligencia Artificial Interactiva</b>. 
        Se reconoce su dedicación, esfuerzo y compromiso con el aprendizaje.
      </p>

      <!-- FECHA Y FIRMA -->
      <div style="display:flex; justify-content:space-between; margin-top:60px; padding:0 40px;">
        <div style="text-align:center;">
          <p style="margin-bottom:50px;">__________________</p>
          <p style="font-weight:bold;">Fecha</p>
          <p id="fecha-diploma"></p>
        </div>
        <div style="text-align:center;">
          <p style="margin-bottom:50px;">__________________</p>
          <p style="font-weight:bold;">Firma</p>
          <p>Ericka Rios</p>
        </div>
      </div>

      <!-- BOTÓN DE DESCARGA (APARECE SOLO AL FINALIZAR EXAMEN) -->
      <div style="text-align:center; margin-top:40px;">
        <button id="btnDiploma" style="
          padding:14px 24px; 
          border-radius:12px; 
          background:linear-gradient(45deg,#22c55e,#16a34a); 
          color:#fff; 
          font-weight:bold; 
          border:none; 
          cursor:pointer; 
          font-size:16px;
          box-shadow:0 4px 12px rgba(0,0,0,0.3);
          transition:.25s;
        ">Descargar PDF</button>
      </div>
</div>

<script>
document.getElementById("btnDiploma").addEventListener("click", function(){
  generarPDF();
});

function mostrarDiplomaFinal(){
  // Mostrar diploma al finalizar examen
  const diploma = document.getElementById("diploma");
  diploma.style.display = "block";

  // Actualizar nombre y fecha
  document.getElementById("nombre-diploma").innerText = usuarioActual || "Estudiante";
  const fecha = new Date();
  document.getElementById("fecha-diploma").innerText = fecha.toLocaleDateString();
  
  // Opcional: desplazar al diploma automáticamente
  diploma.scrollIntoView({behavior:"smooth"});
}

function generarPDF(){
  const diploma = document.getElementById('diploma');

  html2canvas(diploma).then(canvas=>{
    const imgData = canvas.toDataURL('image/png');
    const pdf = new jspdf.jsPDF('landscape','px',[canvas.width,canvas.height]);
    pdf.addImage(imgData,'PNG',0,0,canvas.width,canvas.height);
    pdf.save('diploma_'+(usuarioActual || "estudiante")+'.pdf');
  });
}
</script>

<script>
// ===== ANIMACIÓN DE PARTÍCULAS =====
const canvas = document.getElementById("particlesCanvas");
const ctx = canvas.getContext("2d");
let particles = [];

function resizeCanvas(){
  canvas.width = canvas.offsetWidth;
  canvas.height = canvas.offsetHeight;
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

// Crear partículas
for(let i=0;i<80;i++){
  particles.push({
    x: Math.random() * canvas.width,
    y: Math.random() * canvas.height,
    r: Math.random()*3+1,
    dx: (Math.random()-0.5)*1.2,
    dy: (Math.random()-0.5)*1.2
  });
}

function drawParticles(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(let i=0;i<particles.length;i++){
    const p = particles[i];
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
    ctx.fillStyle="rgba(0,191,255,0.8)";
    ctx.fill();

    // Movimiento
    p.x += p.dx;
    p.y += p.dy;

    // Rebote
    if(p.x<0 || p.x>canvas.width) p.dx*=-1;
    if(p.y<0 || p.y>canvas.height) p.dy*=-1;

    // Conectar partículas cercanas
    for(let j=i+1;j<particles.length;j++){
      const q=particles[j];
      const dist = Math.hypot(p.x-q.x,p.y-q.y);
      if(dist<120){
        ctx.beginPath();
        ctx.moveTo(p.x,p.y);
        ctx.lineTo(q.x,q.y);
        ctx.strokeStyle="rgba(0,191,255,"+(1-dist/120)+")";
        ctx.lineWidth=1;
        ctx.stroke();
      }
    }
  }
  requestAnimationFrame(drawParticles);
}
drawParticles();
</script>
<script>
// ===== VARIALES GLOBALES Y CURSOS =====
let usuarioActual='';
let modulosDesbloqueados=[0]; // Solo el primer módulo desbloqueado
let moduloActual=null;
let preguntas=[];
let preguntaIndex=0;
let vidas=5;
let racha=0;
let avatarSeleccionado='';
let leccionActual = null;

// Variables para regeneración
let ultimoRegen = Date.now(); // timestamp en ms del último "contado" de regeneración
let regenInterval = null;

// Ejemplo de cursos (tu contenido original completo)
const cursos=[  {
    nombre:'Introducción a la Inteligencia Artificial',
    lecciones:[
      {
        titulo:'¿Qué es realmente la IA?',
        contenido:`La Inteligencia Artificial (IA) es el campo que diseña sistemas capaces de realizar tareas que normalmente requieren inteligencia humana: percibir (visión), comprender (lenguaje), razonar y aprender. A diferencia del software con reglas fijas, muchos sistemas de IA aprenden de datos y mejoran con la experiencia.`,
        preguntas:[
          {pregunta:'La IA busca sistemas que puedan…', opciones:['Imitar capacidades inteligentes humanas','Mejorar el hardware sin datos','Funcionar sólo con reglas fijas','Reemplazar internet'], correcta:0},
          {pregunta:'Una diferencia clave frente a software tradicional es que la IA…', opciones:['Puede aprender de datos','Siempre es manual','No usa modelos','Sólo trabaja offline'], correcta:0},
          {pregunta:'Ejemplo de tarea de IA', opciones:['Reconocer imágenes','Romper un cable','Cambiar el color de pantalla','Ordenar archivos por tamaño'], correcta:0},
          {pregunta:'La IA incluye capacidades de…', opciones:['Percepción, lenguaje, razonamiento y aprendizaje','Únicamente dibujo 3D','Sólo compresión de archivos','Solamente redes'], correcta:0},
          {pregunta:'Aprender de la experiencia significa…', opciones:['Mejorar desempeño usando datos','Editar el hardware','Ignorar retroalimentación','Evitar generalizar'], correcta:0}
        ]
      },
      {
        titulo:'Historia breve (años 50 a hoy)',
        contenido:`La IA surge en los años 50 (McCarthy, Minsky) con alto optimismo. Hubo “inviernos” por expectativas no cumplidas. Desde 2010, el auge del aprendizaje profundo y el cómputo acelerado impulsó avances notables en visión, lenguaje y juegos.`,
        preguntas:[
          {pregunta:'La IA nace como campo en…', opciones:['Década de 1950','Década de 1980','Década de 1930','Año 2005'], correcta:0},
          {pregunta:'Los “inviernos de la IA” se debieron a…', opciones:['Expectativas no cumplidas y limitaciones técnicas','Exceso de energía barata','Falta de redes sociales','Prohibición del cómputo'], correcta:0},
          {pregunta:'El gran impulso reciente proviene de…', opciones:['Aprendizaje profundo y GPUs','Impresoras más rápidas','CSS moderno','Monitores 4K'], correcta:0},
          {pregunta:'Áreas con avances recientes', opciones:['Visión y lenguaje','Cableado eléctrico','Impresión 3D hogareña','Diseño textil'], correcta:0},
          {pregunta:'Figura asociada a los inicios', opciones:['John McCarthy','Dennis Ritchie','Tim Berners-Lee','Ada Lovelace'], correcta:0}
        ]
      },
      {
        titulo:'Áreas de la IA',
        contenido:`La IA abarca sistemas expertos (reglas y conocimiento), visión por computador (análisis de imágenes), NLP (lenguaje natural), robótica (percepción+acción) y aprendizaje automático (modelos que aprenden de datos).`,
        preguntas:[
          {pregunta:'Un sistema experto se basa en…', opciones:['Reglas y conocimiento','Únicamente sensores','Solo gráficos 3D','Compresión de vídeo'], correcta:0},
          {pregunta:'La visión por computador trata de…', opciones:['Entender imágenes y vídeo','Optimizar audio','Programar redes','Hacer sitios web'], correcta:0},
          {pregunta:'NLP se ocupa de…', opciones:['Lenguaje natural','Diseño de chips','Geolocalización por GPS','Motores físicos'], correcta:0},
          {pregunta:'La robótica integra…', opciones:['Percepción y acción','Sólo pintura','Únicamente bases de datos','Solo CSS'], correcta:0},
          {pregunta:'El aprendizaje automático…', opciones:['Aprende de datos','No usa datos','Siempre es manual','Es sólo hardware'], correcta:0}
        ]
      },
      {
        titulo:'IA vs ML vs DL',
        contenido:`IA es el campo amplio. ML (aprendizaje automático) es un subconjunto que aprende patrones desde datos. DL (aprendizaje profundo) es un tipo de ML con redes neuronales profundas que escalan con grandes datos y cómputo.`,
        preguntas:[
          {pregunta:'Relación correcta', opciones:['IA > ML > DL','ML > IA > DL','DL > IA > ML','IA = DL'], correcta:0},
          {pregunta:'DL se caracteriza por…', opciones:['Redes neuronales profundas','Datos pequeños','Reglas SI-ENTONCES','Algoritmos sin entrenamiento'], correcta:0},
          {pregunta:'ML aprende…', opciones:['Patrones desde datos','Sólo por reglas fijas','De señales sin datos','Por edición manual'], correcta:0},
          {pregunta:'IA abarca…', opciones:['Muchas técnicas, no solo ML','Sólo hardware','Únicamente gráficos','Un único algoritmo'], correcta:0},
          {pregunta:'DL requiere típicamente…', opciones:['Más datos y cómputo','Nada de datos','Cero GPUs','Menos entrenamiento'], correcta:0}
        ]
      },
      {
        titulo:'Aplicaciones más allá de ChatGPT',
        contenido:`La IA impacta diagnósticos médicos, transporte (conducción asistida), finanzas (detección de fraude), manufactura (mantenimiento predictivo), educación (tutores inteligentes) y más.`,
        preguntas:[
          {pregunta:'Aplicación en salud', opciones:['Diagnóstico asistido','Pintar paredes','Ajustar brillo de pantalla','Ordenar iconos'], correcta:0},
          {pregunta:'En finanzas se usa para…', opciones:['Detectar fraude','Cambiar fondos de pantalla','Medir la RAM','Imprimir tickets'], correcta:0},
          {pregunta:'En transporte ayuda a…', opciones:['Conducción asistida','Escribir cuentos a mano','Mejorar tinta','Coser ropa'], correcta:0},
          {pregunta:'En manufactura permite…', opciones:['Mantenimiento predictivo','Diseño de ropa','Mejorar aromas','Secar pintura'], correcta:0},
          {pregunta:'En educación habilita…', opciones:['Tutores inteligentes','Limpieza de cables','Soldadura manual','Empaquetado fijo'], correcta:0}
        ]
      },
      {
        titulo:'Ética y responsabilidad en la IA',
        contenido:`Los sistemas de IA pueden reproducir sesgos si los datos están sesgados. Es clave la transparencia, explicabilidad, privacidad, responsabilidad y evaluación de impacto para un uso confiable y justo.`,
        preguntas:[
          {pregunta:'Un riesgo clave es…', opciones:['Sesgo algorítmico','Falta de colores','Exceso de RAM','Demasiada batería'], correcta:0},
          {pregunta:'La transparencia ayuda a…', opciones:['Entender decisiones','Acelerar WiFi','Bajar costos de tinta','Agrandar pantallas'], correcta:0},
          {pregunta:'La privacidad protege…', opciones:['Datos personales','Tamaño del monitor','Velocidad del mouse','Fuente tipográfica'], correcta:0},
          {pregunta:'La explicabilidad busca…', opciones:['Motivar interpretabilidad','Eliminar etiquetas','Quitar métricas','Evitar datasets'], correcta:0},
          {pregunta:'Responsabilidad implica…', opciones:['Definir roles y controles','Usar cables largos','Cambiar emojis','Reducir brillo'], correcta:0}
        ]
      }
    ]
  },
  
  // MÓDULO 2
  {
    nombre:'Fundamentos Matemáticos y Computacionales',
    lecciones:[
      {
        titulo:'Álgebra lineal: vectores y matrices',
        contenido:`Vectores representan magnitudes con dirección; matrices organizan datos y transformaciones lineales. En IA, se usan para embeddings, pesos de redes y operaciones como productos y sumas.`,
        preguntas:[
          {pregunta:'Un vector es…', opciones:['Una magnitud con dirección','Una base de datos','Un protocolo','Un archivo ZIP'], correcta:0},
          {pregunta:'Una matriz puede representar…', opciones:['Transformaciones lineales','Contraseñas','URLs','Fondos de pantalla'], correcta:0},
          {pregunta:'En redes neuronales, las matrices suelen ser…', opciones:['Pesos y activaciones','Drivers','Licencias','Cables'], correcta:0},
          {pregunta:'El producto matricial combina…', opciones:['Filas y columnas','Pixeles y audio','CSS y HTML','RAM y ROM'], correcta:0},
          {pregunta:'Embeddings son…', opciones:['Vectores que codifican significado','Imágenes RAW','Archivos PDF','Puertos físicos'], correcta:0}
        ]
      },
      {
        titulo:'Estadística: media, varianza, probabilidad',
        contenido:`La media resume el centro; la varianza la dispersión; la probabilidad modela la incertidumbre. En IA, ayudan a evaluar datos, errores y riesgos.`,
        preguntas:[
          {pregunta:'La media es…', opciones:['Promedio','Máximo','Mínimo','Tendencia'], correcta:0},
          {pregunta:'La varianza mide…', opciones:['Dispersión','Simetría','Altura','Ancho'], correcta:0},
          {pregunta:'La probabilidad modela…', opciones:['Incertidumbre','Velocidad','Memoria','Resolución'], correcta:0},
          {pregunta:'Distribuciones ayudan a…', opciones:['Describir datos','Pintar íconos','Comprimir CSS','Reiniciar PCs'], correcta:0},
          {pregunta:'En evaluación, el error se trata con…', opciones:['Medidas estadísticas','Drivers','Cables','Ratones'], correcta:0}
        ]
      },
      {
        titulo:'Algoritmos y estructuras de datos',
        contenido:`Algoritmos son pasos para resolver problemas; estructuras de datos (listas, colas, pilas, árboles, grafos) almacenan eficientemente. En IA, afectan tiempos de entrenamiento y búsqueda.`,
        preguntas:[
          {pregunta:'Un algoritmo es…', opciones:['Pasos para resolver un problema','Un lenguaje','Una marca','Un puerto'], correcta:0},
          {pregunta:'Una estructura de datos', opciones:['Organiza información','Reemplaza CPU','Pinta pantallas','Actualiza BIOS'], correcta:0},
        {pregunta:'Árboles y grafos sirven para…', opciones:['Relaciones jerárquicas y redes','Compilar CSS','Imprimir tickets','Medir voltaje'], correcta:0},
          {pregunta:'Complejidad ayuda a…', opciones:['Estimar eficiencia','Elegir colores','Cambiar teclado','Aumentar brillo'], correcta:0},
          {pregunta:'Colas y pilas controlan…', opciones:['Orden de acceso','Voltaje','Tamaño de disco','Ruido'], correcta:0}
        ]
      },
      {
        titulo:'Representación del conocimiento y lógica',
        contenido:`Las reglas SI–ENTONCES capturan conocimiento experto. Motores de inferencia aplican reglas a hechos para deducir conclusiones, base de sistemas expertos.`,
        preguntas:[
          {pregunta:'Una regla SI–ENTONCES modela…', opciones:['Conocimiento condicional','Velocidad del WiFi','Colores','Brillo'], correcta:0},
          {pregunta:'El motor de inferencia…', opciones:['Aplica reglas a hechos','Dibuja gráficos','Compila apps','Ajusta audio'], correcta:0},
          {pregunta:'Hechos representan…', opciones:['Información conocida','Fondos','Drivers','Cables'], correcta:0},
          {pregunta:'Encadenamiento hacia adelante…', opciones:['Parte de hechos a conclusiones','Desde la meta al hecho','Sin reglas','Sólo aleatorio'], correcta:0},
          {pregunta:'Los sistemas expertos son…', opciones:['IA basada en reglas','Sólo DL','Sólo hardware','Únicamente visión'], correcta:0}
        ]
      }
    ]
  },
  // MÓDULO 3
  {
    nombre:'Aprendizaje Automático (Machine Learning)',
    lecciones:[
      {
        titulo:'Concepto de ML',
        contenido:`ML permite que modelos aprendan patrones desde datos sin programar explícitamente todas las reglas. Se usa para clasificar, predecir y recomendar.`,
        preguntas:[
          {pregunta:'ML aprende…', opciones:['Patrones desde datos','Sólo reglas fijas','Sin ejemplos','Solo hardware'], correcta:0},
          {pregunta:'Una tarea típica', opciones:['Clasificación','Soldadura','Pintura','Coser'], correcta:0},
          {pregunta:'Requiere…', opciones:['Datos etiquetados o no','Sólo BIOS','Cables nuevos','Drivers'], correcta:0},
          {pregunta:'Se usa para…', opciones:['Predecir y recomendar','Abrir archivos','Cambiar idioma del SO','Mover ventanas'], correcta:0},
          {pregunta:'No es cierto que…', opciones:['No necesita datos','Puede generalizar','Usa modelos','Optimiza parámetros'], correcta:0}
        ]
      },
      {
        titulo:'Tipos de aprendizaje',
        contenido:`Supervisado usa pares (x,y) para predecir etiquetas; no supervisado descubre estructura (clusters); por refuerzo aprende por recompensas en interacción con un entorno.`,
        preguntas:[
          {pregunta:'Supervisado usa…', opciones:['Etiquetas','Sólo texto sin etiquetas','Nada de datos','Motores físicos'], correcta:0},
          {pregunta:'No supervisado busca…', opciones:['Estructura oculta','Recompensas','Compilar apps','Dibujar'], correcta:0},
          {pregunta:'Por refuerzo aprende…', opciones:['Con recompensas','Con etiquetas fijas','Sin interacción','Sólo con reglas SI'], correcta:0},
          {pregunta:'Ejemplo de supervisado', opciones:['Predicción de precios','Agrupar clientes','Explorar un juego','Planchar ropa'], correcta:0},
          {pregunta:'Ejemplo de no supervisado', opciones:['Clustering de clientes','Control de robot por recompensa','Detección con etiquetas','Edición de video'], correcta:0}
        ]
      },
      {
        titulo:'Flujo de trabajo en ML',
        contenido:`El ciclo típico: recolectar datos, preparar/limpiar, dividir en entrenamiento/validación, entrenar el modelo, evaluar con métricas y ajustar hiperparámetros.`,
        preguntas:[
          {pregunta:'Primer paso', opciones:['Recolectar datos','Publicar resultados','Ignorar calidad','Desplegar'], correcta:0},
          {pregunta:'Preparar datos implica…', opciones:['Limpiar y transformar','Sólo comprimir','Cambiar colores','Renombrar archivos'], correcta:0},
          {pregunta:'División común', opciones:['Entrenamiento/validación','Producción/soporte','UX/UI','Hardware/software'], correcta:0},
          {pregunta:'Evaluar requiere…', opciones:['Métricas adecuadas','Sólo intuición','Colores vivos','Drivers nuevos'], correcta:0},
          {pregunta:'Ajustar hiperparámetros…', opciones:['Mejora desempeño','Siempre empeora','No afecta','Elimina datos'], correcta:0}
        ]
      }
    ]
  },
  // MÓDULO 4
  {
    nombre:'Herramientas y Lenguajes para IA',
    lecciones:[
      {
        titulo:'Introducción a Python para IA',
        contenido:`Python es popular por su sintaxis simple y ecosistema rico. Facilita prototipos rápidos y experimentación en ciencia de datos e IA.`,
        preguntas:[
          {pregunta:'Python destaca por…', opciones:['Ecosistema y simplicidad','Licencia cara','Sólo bajo nivel','Ser propietario'], correcta:0},
          {pregunta:'Se usa mucho en…', opciones:['Ciencia de datos','Edición de video','Diseño 3D','Sistemas embebidos críticos'], correcta:0},
          {pregunta:'Facilita…', opciones:['Prototipos rápidos','Drivers de impresora','Firmware','BIOS'], correcta:0},
          {pregunta:'No es ventaja…', opciones:['Sintaxis confusa','Ecosistema amplio','Comunidad','Bibliotecas'], correcta:0},
          {pregunta:'Entorno común', opciones:['Jupyter','Excel','Word','Paint'], correcta:0}
        ]
      },
      {
        titulo:'Librerías: NumPy, Pandas, Matplotlib',
        contenido:`NumPy gestiona arreglos y operaciones numéricas; Pandas maneja tablas (DataFrames); Matplotlib visualiza datos con gráficos básicos.`,
        preguntas:[
          {pregunta:'NumPy es para…', opciones:['Arreglos y álgebra','Mapas','Audio','Impresión'], correcta:0},
          {pregunta:'Pandas ofrece…', opciones:['DataFrames','Drivers','Sockets','BIOS'], correcta:0},
          {pregunta:'Matplotlib sirve para…', opciones:['Gráficos','Archivar','Compilar','Encriptar'], correcta:0},
          {pregunta:'Pipeline típico', opciones:['Cargar, transformar, graficar','Imprimir, pintar, cortar','Encender, apagar, reiniciar','Coser, pegar, lijar'], correcta:0},
          {pregunta:'DataFrame es…', opciones:['Tabla etiquetada','Imagen','Audio','Video'], correcta:0}
        ]
      },
      {
        titulo:'Primeros pasos con scikit-learn',
        contenido:`scikit-learn ofrece modelos de ML clásicos (regresión, SVM, árboles) con APIs consistentes: fit/predict, pipelines y evaluación.`,
        preguntas:[
          {pregunta:'scikit-learn provee…', opciones:['Modelos de ML clásicos','Edición de video','Render 3D','Drivers GPU'], correcta:0},
          {pregunta:'API común', opciones:['fit/predict','open/close','send/recv','get/set'], correcta:0},
          {pregunta:'Incluye…', opciones:['Pipelines y métricas','Motores gráficos','Sistemas operativos','Routers'], correcta:0},
          {pregunta:'Un modelo de clasificación', opciones:['SVM','HDMI','PNG','MIDI'], correcta:0},
          {pregunta:'Para evaluar se usa…', opciones:['Accuracy, F1, ROC','DPI, PPI','FPS','Hz'], correcta:0}
        ]
      },
      {
        titulo:'Jupyter Notebook / Google Colab',
        contenido:`Jupyter y Colab permiten notebooks interactivos para mezclar código, texto y gráficos. Ideales para experimentación y compartir resultados.`,
        preguntas:[
          {pregunta:'Un notebook integra…', opciones:['Código y texto','Sólo binarios','Solo CSS','Sólo audio'], correcta:0},
          {pregunta:'Colab ofrece…', opciones:['Entorno en la nube','Hardware propio','Impresoras','Drivers'], correcta:0},
          {pregunta:'Útil para…', opciones:['Experimentar y documentar','Pintar paredes','Hornear','Vaciar caché'], correcta:0},
          {pregunta:'Se usa con…', opciones:['Python','Cobol puro','Batch','Pascal'], correcta:0},
          {pregunta:'Ventaja clave', opciones:['Compartir fácilmente','No guardar','Cortar internet','Quitar textos'], correcta:0}
        ]
      }
    ]
  },
  // MÓDULO 5
  {
    nombre:'Proyecto Guiado',
    lecciones:[
      {
        titulo:'Elegir dataset sencillo',
        contenido:`Elige un dataset pequeño y claro (calificaciones, spam, flores). Debe tener variables relevantes y pocos valores faltantes para empezar.`,
        preguntas:[
          {pregunta:'Buen dataset inicial', opciones:['Spam SMS','Sistema operativo','Firmware','Mapa de calor de GPU'], correcta:0},
          {pregunta:'Conviene que sea…', opciones:['Pequeño y claro','Masivo y ruidoso','Secreto y cerrado','Sin etiquetas siempre'], correcta:0},
          {pregunta:'Variable relevante es…', opciones:['Aporta al objetivo','Es bonita','Tiene colores','Es larga'], correcta:0},
          {pregunta:'Valores faltantes excesivos…', opciones:['Complican el inicio','Mejoran el modelo','No importan','Son ideales'], correcta:0},
          {pregunta:'Ejemplo clásico', opciones:['Iris (flores)','Juegos 4K','Drivers BIOS','Fotos RAW'], correcta:0}
        ]
      },
      {
        titulo:'Limpieza y exploración',
        contenido:`Realiza profiling: revisar nulos, duplicados, tipos; normalizar/estandarizar; explorar con descripciones y gráficos para entender patrones y outliers.`,
        preguntas:[
          {pregunta:'Primer paso EDA', opciones:['Revisar nulos y tipos','Comprimir ZIP','Cambiar fuente','Imprimir'], correcta:0},
          {pregunta:'Outlier es…', opciones:['Valor atípico','Media','Moda','Ruido blanco'], correcta:0},
          {pregunta:'Normalizar/estandarizar…', opciones:['Ajusta escalas','Elimina columnas buenas','Rompe índices','Duplica filas'], correcta:0},
          {pregunta:'Gráficos ayudan a…', opciones:['Ver patrones','Cambiar teclado','Ajustar brillo','Reiniciar router'], correcta:0},
          {pregunta:'Duplicados deben…', opciones:['Controlarse/eliminarse','Ignorarse siempre','Aumentarse','Celebrarse'], correcta:0}
        ]
      },
      {
        titulo:'Entrenamiento supervisado',
        contenido:`Elige un algoritmo (regresión o clasificación), divide datos, entrena con fit, valida y ajusta hiperparámetros. Evita overfitting con regularización o validación cruzada.`,
        preguntas:[
          {pregunta:'Para clasificación usarías…', opciones:['Logística o árboles','Wavelet','MD5','SVG'], correcta:0},
          {pregunta:'Validación cruzada…', opciones:['Evalúa con particiones','Pinta pantallas','Cambia puertos','Formatea disco'], correcta:0},
          {pregunta:'Overfitting es…', opciones:['Ajuste excesivo al entrenamiento','Poca RAM','Disco lleno','Error de red'], correcta:0},
          {pregunta:'Regularización ayuda a…', opciones:['Reducir sobreajuste','Acelerar GPU','Mejorar WiFi','Bajar brillo'], correcta:0},
          {pregunta:'Dividir datos en…', opciones:['Train/valid','Prod/test','UX/UI','CPU/GPU'], correcta:0}
        ]
      },
      {
        titulo:'Visualización de resultados',
        contenido:`Reporta métricas (accuracy, F1, MAE) y gráficos (matriz de confusión, curvas ROC). Explica hallazgos y límites del modelo.`,
        preguntas:[
          {pregunta:'Para clasificación, métrica', opciones:['F1/Accuracy','FPS','DPI','Hz'], correcta:0},
          {pregunta:'Matriz de confusión muestra…', opciones:['Aciertos/errores por clase','Brillo','Audio','RAM'], correcta:0},
          {pregunta:'ROC evalúa…', opciones:['Trade-off TP/FP','Resolución de pantalla','Velocidad del CPU','Latencia'], correcta:0},
          {pregunta:'Para regresión, métrica', opciones:['MAE/MSE','ISO','MIDI','RGB'], correcta:0},
          {pregunta:'Explicar límites ayuda a…', opciones:['Uso responsable','Acelerar GPU','Ahorrar tinta','Limpiar teclado'], correcta:0}
        ]
      },
      {
        titulo:'Presentación del proyecto',
        contenido:`Cuenta el problema, datos, método, resultados y próximos pasos. Usa visuales claros y conclusiones accionables. Mantén reproducibilidad.`,
        preguntas:[
          {pregunta:'Debe incluir…', opciones:['Problema y datos','Chistes','Fondos ruidosos','Contraseñas'], correcta:0},
          {pregunta:'Conclusiones deben ser…', opciones:['Accionables','Secretas','Vagas','Decorativas'], correcta:0},
          {pregunta:'Reproducibilidad requiere…', opciones:['Código y semillas','Más monitores','Cables caros','GIFs'], correcta:0},
          {pregunta:'Visuales deben ser…', opciones:['Claros','Excesivos','Aleatorios','Oscuros'], correcta:0},
          {pregunta:'Próximos pasos…', opciones:['Plan futuro','Nada','Eliminar todo','Ocultar fallos'], correcta:0}
        ]
      }
    ]
  },
  // MÓDULO 6
  {
    nombre:'Más Allá del Principio',
    lecciones:[
      {
        titulo:'Otras ramas: CV, NLP, Robótica',
        contenido:`Visión por computador procesa imágenes/vídeo; NLP entiende/genera lenguaje; robótica combina percepción, planeación y control para actuar en el mundo físico.`,
        preguntas:[
          {pregunta:'CV trabaja con…', opciones:['Imágenes/vídeo','Audio','BIOS','Impresoras'], correcta:0},
          {pregunta:'NLP trata…', opciones:['Lenguaje natural','Soldadura','Texturas 3D','FPS'], correcta:0},
          {pregunta:'Robótica integra…', opciones:['Percepción y control','Sólo texto','Sólo sonido','Sólo color'], correcta:0},
          {pregunta:'Planeación en robots decide…', opciones:['Secuencia de acciones','Tipo de cable','Tema de escritorio','Fuente'], correcta:0},
          {pregunta:'Sensado típico', opciones:['Cámaras/LIDAR','Router','Impresora','Proyector'], correcta:0}
        ]
      },
      {
        titulo:'Retos actuales de la IA',
        contenido:`Retos: sesgos, explicabilidad, robustez a ataques, privacidad, eficiencia energética, y alineación con valores humanos.`,
        preguntas:[
          {pregunta:'Un reto clave', opciones:['Explicabilidad','Agrandar iconos','Más DPI','Más ventiladores'], correcta:0},
          {pregunta:'Robustez busca…', opciones:['Resistir perturbaciones','Bajar brillo','Subir volumen','Cambiar idioma'], correcta:0},
          {pregunta:'Privacidad protege…', opciones:['Datos sensibles','Cables','Fuentes','Puertos'], correcta:0},
          {pregunta:'Eficiencia energética…', options:['Reduce consumo','Sube ruido','Baja FPS','Quita RAM'], correcta:0},
          {pregunta:'Alineación es…', options:['Seguir valores humanos','Seguir píxeles','Seguir frames','Seguir puertos'], correcta:0}
        ]
      },
      {
        titulo:'Cómo seguir aprendiendo: DL',
        contenido:`Profundiza en Deep Learning con TensorFlow o PyTorch; estudia CNNs, RNNs, Transformers; practica en datasets reales y cuida regularización y buenas prácticas.`,
        preguntas:[
          {pregunta:'Framework DL', opciones:['PyTorch/TensorFlow','DirectX','OpenGL','Bootstrap'], correcta:0},
          {pregunta:'Arquitectura moderna', opciones:['Transformers','Modems','BIOS','Routers'], correcta:0},
          {pregunta:'CNNs se usan en…', opciones:['Imágenes','Audio analógico','BIOS','Impresión'], correcta:0},
          {pregunta:'Buena práctica', opciones:['Regularización','Ignorar validación','No versionar','Datos sin limpieza'], correcta:0},
          {pregunta:'Aprender requiere…', opciones:['Practicar en datasets','Solo leer títulos','Dejar métricas','Evitar código'], correcta:0}
        ]
      },
      {
        titulo:'Modelos generativos y ética/futuro',
        contenido:`Modelos generativos (ChatGPT, Stable Diffusion) crean texto/imágenes. Su futuro demanda gestión de sesgos, derechos de autor, trazabilidad y usos responsables.`,
        preguntas:[
          {pregunta:'Un modelo generativo', opciones:['Stable Diffusion','Excel','Chrome','WinRAR'], correcta:0},
          {pregunta:'Generativos producen…', opciones:['Contenido nuevo','Sólo métricas','Sólo logs','Sólo drivers'], correcta:0},
          {pregunta:'Tema ético', opciones:['Derechos de autor','Zoom de pantalla','Tema oscuro','Brillo'], correcta:0},
          {pregunta:'Trazabilidad ayuda a…', opciones:['Rastrear orígenes','Aumentar DPI','Subir volumen','Cambiar puertos'], correcta:0},
          {pregunta:'Uso responsable implica…', opciones:['Evaluar impactos','Ignorar sesgos','Ocultar datos','Eliminar límites'], correcta:0}
        ]
      }
    ]
  }
    
 
];

/* ===== FUNCIONES DE USUARIO ===== */
function registrarUsuario(){
  const nombre = document.getElementById('usuarioNombre').value.trim();
  if(nombre === ''){ document.getElementById('mensajeUsuario').innerText = 'Ingrese un nombre válido'; return;}
  if(localStorage.getItem('usuario_' + nombre)){
    document.getElementById('mensajeUsuario').innerText = 'Nombre ya registrado';
    return;
  }
  let data = {vidas:5, racha:0, modulosDesbloqueados:[0], avatar:'', leccionesCompletadas:{}, examenCompletado:false, ultimoRegen: Date.now()};
  localStorage.setItem('usuario_'+nombre, JSON.stringify(data));
  usuarioActual = nombre;
  document.getElementById('pantallaInicio').style.display='none';
  document.getElementById('seleccionAvatar').style.display='block';
}

function iniciarSesion(){
  const nombre=document.getElementById('usuarioNombre').value.trim();
  const data=localStorage.getItem('usuario_'+nombre);
  if(data){
    usuarioActual=nombre;
    const obj=JSON.parse(data);
    if(obj.avatar){ 
      avatarSeleccionado=obj.avatar;
      vidas=obj.vidas !== undefined ? obj.vidas : 5;
      racha=obj.racha !== undefined ? obj.racha : 0;
      modulosDesbloqueados = Array.isArray(obj.modulosDesbloqueados) ? obj.modulosDesbloqueados : [0];
      ultimoRegen = obj.ultimoRegen !== undefined ? Number(obj.ultimoRegen) : Date.now();
      iniciarCurso();
    } else { 
      document.getElementById('pantallaInicio').style.display='none';
      document.getElementById('seleccionAvatar').style.display='block';
      // restore values in case available
      ultimoRegen = obj.ultimoRegen !== undefined ? Number(obj.ultimoRegen) : Date.now();
      vidas = obj.vidas !== undefined ? obj.vidas : 5;
    }
  } else{
    document.getElementById('mensajeUsuario').innerText='Usuario no encontrado';
  }
}

function elegirAvatar(imagen){
  avatarSeleccionado=imagen;
  let obj=JSON.parse(localStorage.getItem('usuario_'+usuarioActual));
  obj.avatar=imagen;
  obj.ultimoRegen = obj.ultimoRegen !== undefined ? Number(obj.ultimoRegen) : Date.now();
  localStorage.setItem('usuario_'+usuarioActual, JSON.stringify(obj));

  // Ocultar selección de avatar completamente
  document.getElementById('seleccionAvatar').style.display='none';

  // Restaurar progreso
  vidas = obj.vidas !== undefined ? obj.vidas : 5;
  racha = obj.racha !== undefined ? obj.racha : 0;
  modulosDesbloqueados = Array.isArray(obj.modulosDesbloqueados) ? obj.modulosDesbloqueados : [0];
  ultimoRegen = obj.ultimoRegen !== undefined ? Number(obj.ultimoRegen) : Date.now();

  iniciarCurso();
}

function iniciarCurso(){
  document.getElementById('pantallaInicio').style.display='none';
  document.getElementById('siteHeader').style.display='flex';
  document.getElementById('avatarHeader').src=avatarSeleccionado;
  document.getElementById('avatarHeader').style.display='block';
  mostrarSeccion('inicio');
  actualizarVidas();
  renderModulos();
  iniciarRegeneracionVidas(); // inicia la lógica de regeneración
}

function mostrarSeccion(seccion){
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.getElementById(seccion).classList.add('active');
  // si sales del examen, detener timer (manejo simple)
  if(seccion !== 'examenFinal'){
    // no hacemos nada adicional aquí para no cerrar prueba inesperadamente
  }
}

/* ===== MODULOS ===== */
function renderModulos(){
  const cont=document.getElementById('modulos');
  cont.innerHTML='';
  const obj = JSON.parse(localStorage.getItem('usuario_'+usuarioActual) || '{}');
  // ensure structure exists
  if(!obj.modulosDesbloqueados) obj.modulosDesbloqueados = [0];
  if(!obj.leccionesCompletadas) obj.leccionesCompletadas = {};

  cursos.forEach((mod,i)=>{
    const div=document.createElement('div');
    div.className='modulo-card';
    if(obj.modulosDesbloqueados.includes(i)) div.classList.add('desbloqueado');
    else div.classList.add('bloqueado');

    // mark completed if user has completed this module's all lessons
    const completadas = obj.leccionesCompletadas[i] || [];
    if(Array.isArray(completadas) && completadas.length === (cursos[i].lecciones ? cursos[i].lecciones.length : 0)){
      div.classList.add('completado');
    }

    if(obj.modulosDesbloqueados.includes(i)) div.onclick=()=>abrirModulo(i);
    div.innerHTML=`<h3>${mod.nombre}</h3>`;
    cont.appendChild(div);
  });

  // ===== Examen Final como último módulo =====
  const examenDiv=document.createElement('div');
  examenDiv.className='modulo-card';

  // check if all modules fully completed
  let allCompleted = true;
  for(let mi=0; mi<cursos.length; mi++){
    const comp = obj.leccionesCompletadas[mi] || [];
    if(!Array.isArray(comp) || comp.length < (cursos[mi].lecciones ? cursos[mi].lecciones.length : 0)){
      allCompleted = false; break;
    }
  }

  examenDiv.innerHTML=`<h3>📝 Examen Final</h3>`;
  if(obj.examenCompletado){
    examenDiv.classList.add('completado');
    examenDiv.onclick = ()=>{ alert('Ya completaste el examen final.'); };
  } else if(allCompleted){
    examenDiv.classList.add('desbloqueado');
    examenDiv.onclick = ()=>{ mostrarSeccion('examenFinal'); generarExamen(); };
  } else {
    examenDiv.classList.add('bloqueado');
  }
  cont.appendChild(examenDiv);
}

/* ===== PREGUNTAS ===== */
function empezarPreguntas(){
  const leccion = cursos[moduloActual].lecciones[leccionActual];
  preguntas = [...leccion.preguntas];
  preguntaIndex = 0;
  document.getElementById('leccionInfo').style.display='none';
  document.getElementById('barraProgresoContainer').style.display='block';
  mostrarPregunta();
}

function mostrarPregunta(){
  const cont=document.getElementById('pregunta-container');
  cont.style.display='block';
  cont.innerHTML='';
  const p = preguntas[preguntaIndex];
  let opciones = [...p.opciones];
  shuffleArray(opciones);
  const divPregunta=document.createElement('div');
  divPregunta.className='pregunta';
  divPregunta.innerHTML=`<h3>${p.pregunta}</h3>`;
  cont.appendChild(divPregunta);
  opciones.forEach((op)=>{ 
    const btn=document.createElement('button');
    btn.className='responder';
    btn.innerText=op;
    // Si las vidas ya son 0, dejar el botón desactivado
    btn.disabled = (vidas <= 0);
    btn.onclick=()=>responder(op,p.correcta);
    cont.appendChild(btn);
  });
  const btnVolver=document.createElement('button');
  btnVolver.className='volver';
  btnVolver.innerText='Volver a módulos';
  btnVolver.onclick=volverAModulos;
  cont.appendChild(btnVolver);
  actualizarBarraProgreso();
}

function responder(opcion,correctIndex){
  const correcta = preguntas[preguntaIndex].opciones[correctIndex];
  const mensaje=document.getElementById('mensajeRespuesta');
  if(opcion===correcta){ racha++; mensaje.innerText='Correcto!'; mensaje.style.color='#22c55e'; }
  else{ 
    vidas--; 
    racha=0; 
    mensaje.innerText='Incorrecto!'; 
    mensaje.style.color='#f87171'; 
    actualizarVidas(); 
    if(vidas<=0){
      // cuando se acaban las vidas, fijar el timestamp para comenzar a contar la regeneración
      ultimoRegen = Date.now();
      alert('Se acabaron las vidas! Debes esperar para recuperar energía.');
      // Desactivar todos los botones de respuesta en esta pantalla
      document.querySelectorAll('#pregunta-container button.responder').forEach(btn => btn.disabled = true);
      // Guardar progreso (vidas = 0 y ultimoRegen)
      guardarProgreso();
      return;
    }
  }
  document.getElementById('barra-racha').innerText='Racha: '+racha;
  preguntaIndex++;
  guardarProgreso();
  if(preguntaIndex<preguntas.length) mostrarPregunta();
  else { 
    alert('Lección completada');
    marcarLeccionCompletada();
  }
}

/* ===== MARCAR LECCIÓN ===== */
function marcarLeccionCompletada(){
  const obj = JSON.parse(localStorage.getItem('usuario_'+usuarioActual));
  if(!obj.leccionesCompletadas[moduloActual]) obj.leccionesCompletadas[moduloActual]=[];
  if(!obj.leccionesCompletadas[moduloActual].includes(leccionActual)) obj.leccionesCompletadas[moduloActual].push(leccionActual);
  if(leccionActual === cursos[moduloActual].lecciones.length-1){
    desbloquearModulo(moduloActual+1);
  }
  localStorage.setItem('usuario_'+usuarioActual, JSON.stringify(obj));

  // Limpiar mensaje de respuesta al terminar la lección
  document.getElementById('mensajeRespuesta').innerText='';

  renderModulos();
  volverAModulos();
}

/* ===== VIDAS ===== */
function actualizarVidas(){
  const cont=document.getElementById('barra-vidas');
  cont.innerHTML='';
  for(let i=0;i<5;i++){
    const c=document.createElement('span');
    c.className='corazon'; if(i>=vidas) c.classList.add('vacio');
    cont.appendChild(c);
  }
}

/* ===== DESBLOQUEAR MODULO ===== */
function desbloquearModulo(idx){
  if(idx>=cursos.length) return;
  const obj = JSON.parse(localStorage.getItem('usuario_'+usuarioActual));
  if(!obj.modulosDesbloqueados.includes(idx)) obj.modulosDesbloqueados.push(idx);
  localStorage.setItem('usuario_'+usuarioActual, JSON.stringify(obj));
}

/* ===== BARRA PROGRESO ===== */
function actualizarBarraProgreso(){
  const barra=document.getElementById('barraProgreso');
  let porcentaje=Math.floor((preguntaIndex/preguntas.length)*100);
  barra.style.width=porcentaje+'%';
}

/* ===== GUARDAR PROGRESO ===== */
function guardarProgreso(){
  const obj = JSON.parse(localStorage.getItem('usuario_'+usuarioActual) || '{}');
  obj.vidas = vidas;
  obj.racha = racha;
  obj.ultimoRegen = ultimoRegen;
  localStorage.setItem('usuario_'+usuarioActual, JSON.stringify(obj));
}

/* ===== UTIL ===== */
function shuffleArray(array){
  for(let i=array.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [array[i],array[j]]=[array[j],array[i]];
  }
}

function volverAModulos() {
  document.getElementById('leccionInfo').style.display = 'none';
  document.getElementById('pregunta-container').style.display = 'none';
  document.getElementById('barraProgresoContainer').style.display = 'none';
  document.getElementById('mensajeRespuesta').innerHTML = '';
  document.getElementById('leccionesMenu').style.display = 'none';

  document.getElementById('modulos').style.display = 'grid';
}

function abrirModulo(index){
  const obj = JSON.parse(localStorage.getItem('usuario_'+usuarioActual));
  if(!obj.modulosDesbloqueados.includes(index)) return;
  moduloActual = index;

  // Mostrar menú de lecciones con botón de volver
  document.getElementById('modulos').style.display='none';
  document.getElementById('leccionesMenu').style.display='block';
  const cont = document.getElementById('listaLecciones');
  cont.innerHTML = '';

  if(!obj.leccionesCompletadas[moduloActual]) obj.leccionesCompletadas[moduloActual]=[];

  cursos[index].lecciones.forEach((leccion,i)=>{
    const div = document.createElement('div');
    div.className='modulo-card';
    if(i===0 || obj.leccionesCompletadas[moduloActual].includes(i-1)){
      div.classList.add('desbloqueado');
      div.onclick = ()=>abrirLeccion(i);
    } else div.classList.add('bloqueado');

    if(obj.leccionesCompletadas[moduloActual].includes(i)) div.classList.add('completado');
    div.innerHTML=`<h4>${leccion.titulo}</h4>`;
    cont.appendChild(div);
  });
}

function abrirLeccion(index){
  leccionActual = index;
  const leccion = cursos[moduloActual].lecciones[index];

  // Ocultar la lista de lecciones
  document.getElementById('leccionesMenu').style.display='none';

  // Mostrar la lección
  document.getElementById('modulos').style.display='none';
  document.getElementById('leccionInfo').style.display='block';
  document.getElementById('tituloLeccion').innerText = leccion.titulo;
  document.getElementById('contenidoLeccion').innerText = leccion.contenido || 'Contenido de la lección...';
}

/* ===== Lógica Examen Final añadida ===== */
let examenPreguntas = [];
let examenIndex = 0;
let examenCorrectas = 0;
let tiempoRestante = 600; // 10 minutos
let timerInterval = null;
let examenActivo = false;

function generarExamen(){
  // prevenir reinicio si ya está activo
  examenPreguntas = [];
  examenIndex = 0;
  examenCorrectas = 0;
  examenActivo = true;
  const obj = JSON.parse(localStorage.getItem('usuario_'+usuarioActual) || '{}');

  // compilar banco de preguntas
  cursos.forEach(mod=>{
    mod.lecciones.forEach(lec=>{
      if(Array.isArray(lec.preguntas)) examenPreguntas.push(...lec.preguntas);
    });
  });

  shuffleArray(examenPreguntas);
  // limitar a 15 preguntas o al total disponible si es menor
  if(examenPreguntas.length > 15) examenPreguntas = examenPreguntas.slice(0,15);

  // mostrar y arrancar timer
  mostrarPreguntaExamen();
  iniciarTimer();

  // asegurar que la sección examen esté visible y otras ocultas
  mostrarSeccion('examenFinal');
}

function mostrarPreguntaExamen(){
  const cont = document.getElementById('pregunta-examen');
  const mensaje = document.getElementById('mensajeExamen');
  cont.innerHTML = '';
  mensaje.innerText = '';
  if(examenIndex >= examenPreguntas.length){
    finalizarExamen('done');
    return;
  }
  const p = examenPreguntas[examenIndex];
  const div = document.createElement('div');
  div.className = 'pregunta';
  div.innerHTML = `<h3>${p.pregunta}</h3>`;
  cont.appendChild(div);

  let opciones = [...p.opciones];
  shuffleArray(opciones);
  opciones.forEach(op=>{
    const btn = document.createElement('button');
    btn.className = 'responder';
    btn.innerText = op;
    btn.onclick = ()=>responderExamen(op, p.opciones[p.correcta]);
    cont.appendChild(btn);
  });
}

function responderExamen(opcion, correcta){
  const msg = document.getElementById('mensajeExamen');
  if(opcion === correcta){
    examenCorrectas++;
    msg.innerText = '✅ Correcto!';
    msg.style.color = '#22c55e';
  } else {
    msg.innerText = '❌ Incorrecto!';
    msg.style.color = '#f87171';
  }
  examenIndex++;
  // breve pausa antes de la siguiente pregunta
  setTimeout(()=>{ mostrarPreguntaExamen(); }, 700);
}

function iniciarTimer(){
  // limpiar si había uno anterior
  if(timerInterval) clearInterval(timerInterval);
  tiempoRestante = 600;
  actualizarTimer();
  timerInterval = setInterval(()=>{
    tiempoRestante--;
    actualizarTimer();
    if(tiempoRestante <= 0){
      clearInterval(timerInterval);
      finalizarExamen('time');
    }
  },1000);
}

function actualizarTimer(){
  const el = document.getElementById('timer');
  if(!el) return;
  const min = Math.floor(tiempoRestante/60);
  const seg = tiempoRestante % 60;
  el.innerText = `Tiempo restante: ${min}:${seg<10? '0'+seg : seg}`;
}

function finalizarExamen(reason='done'){
  // reason: 'done'|'time'|'cancel'
  examenActivo = false;
  if(timerInterval) { clearInterval(timerInterval); timerInterval = null; }
  const cont = document.getElementById('pregunta-examen');
  const msg = document.getElementById('mensajeExamen');
  if(reason === 'time'){
    msg.innerHTML = `⏰ Se terminó el tiempo. Resultado: ${examenCorrectas} / ${examenPreguntas.length}`;
  } else if(reason === 'cancel'){
    msg.innerHTML = 'Has salido del examen.';
  } else {
    msg.innerHTML = `🎉 Examen finalizado. Resultado: ${examenCorrectas} / ${examenPreguntas.length}`;
  }

  // marcar examen como completado (se puede ajustar si quieres un umbral de aprobación)
  const nombre = usuarioActual || '';
  if(nombre){
    const obj = JSON.parse(localStorage.getItem('usuario_'+nombre) || '{}');
    obj.examenCompletado = true;
    // guardar resultados
    obj.ultimoResultadoExamen = {correctas: examenCorrectas, total: examenPreguntas.length, fecha: new Date().toISOString()};
    localStorage.setItem('usuario_'+nombre, JSON.stringify(obj));
  }

  // === AQUI AGREGAS EL DIPLOMA ===
mostrarDiploma(); // función que ya debes tener definida
const diplomaDiv = document.getElementById('diploma');
if(diplomaDiv) diplomaDiv.style.display = 'block';

  // limpiar interfaz de preguntas
  if(cont) cont.innerHTML = '';

  // regresar a módulos luego de un segundo
  setTimeout(()=>{
    mostrarSeccion('lecciones');
    renderModulos();
  },1200);
}

// Asegurarse de detener el timer si el usuario navega fuera del examen
function salirDeExamenSiEsNecesario(){
  if(examenActivo){
    if(confirm('Estás en medio del examen. ¿Deseas salir?')) finalizarExamen('cancel');
  }
}

// si el usuario cambia de sección manualmente, detener timer (opcional)
window.addEventListener('beforeunload', ()=>{
  if(timerInterval) clearInterval(timerInterval);
  if(regenInterval) clearInterval(regenInterval);
});

/* ===== REGENERACIÓN AUTOMÁTICA DE VIDAS =====
   Regenera 1 vida cada 5 minutos (300000 ms) hasta máximo 5.
   - Si pasaron N*5 minutos mientras el usuario estaba desconectado, se regeneran N vidas (sin superar 5).
   - Conserva el sobrante de minutos (ej: si pasaron 12 minutos -> regenera 2 vidas y quedan 2 minutos contándose).
*/
function iniciarRegeneracionVidas(){
  if(!usuarioActual) return;
  const obj = JSON.parse(localStorage.getItem('usuario_'+usuarioActual) || '{}');
  ultimoRegen = obj.ultimoRegen !== undefined ? Number(obj.ultimoRegen) : Date.now();

  // Chequeo inicial (regenera si corresponde)
  chequearRegeneracion();

  // Limpiar intervalo previo si existe
  if(regenInterval) clearInterval(regenInterval);
  regenInterval = setInterval(chequearRegeneracion, 30000); // cada 30s revisa
}

function chequearRegeneracion(){
  const ahora = Date.now();
  // minutos completos desde ultimoRegen
  const minutosPasados = Math.floor((ahora - Number(ultimoRegen)) / 60000);
  if(minutosPasados < 5) return; // nada que hacer

  if(vidas >= 5){
    // Si vidas ya al maximo, actualizamos ultimoRegen para no acumular tiempo innecesario
    ultimoRegen = Number(ultimoRegen);
    guardarProgreso();
    return;
  }

  // cuántos bloques de 5 minutos hay
  const bloques = Math.floor(minutosPasados / 5);
  const recuperar = Math.min(bloques, 5 - vidas); // no pasar de 5
  if(recuperar > 0){
    vidas += recuperar;
    // avanzamos el timestamp en tantos bloques recuperados (conservamos el sobrante de minutos)
    ultimoRegen = Number(ultimoRegen) + (recuperar * 5 * 60000);
    actualizarVidas();

    // si estamos en pantalla de preguntas, re-habilitar botones
    document.querySelectorAll('#pregunta-container button.responder').forEach(btn => {
      if(btn) btn.disabled = false;
    });

    // Guardar en localStorage
    const obj = JSON.parse(localStorage.getItem('usuario_'+usuarioActual) || '{}');
    obj.vidas = vidas;
    obj.ultimoRegen = ultimoRegen;
    localStorage.setItem('usuario_'+usuarioActual, JSON.stringify(obj));
  }
}
</script>
</body>
</html>
